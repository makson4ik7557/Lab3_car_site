{% extends "car_templates/base.html" %}

{% block title %}{{ page_title }} - Car Sale Site{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="{% url 'car_list' %}" class="btn btn-secondary">← Back to Regular List</a>
</div>

<div class="card api-info-card">
    <h2>API Demo</h2>
    <p>This page demonstrates fetching data from the REST API using the <code>requests</code> library.</p>
    <p>The data is retrieved from: <code>http://127.0.0.1:8000/api/cars/</code></p>
</div>

<h1>{{ page_title }}</h1>

{% if cars %}
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Make</th>
            <th>Model</th>
            <th>Year</th>
            <th>Price</th>
            <th>In Stock</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for car in cars %}
        <tr>
            <td>{{ car.id }}</td>
            <td>{{ car.make }}</td>
            <td>{{ car.model }}</td>
            <td>{{ car.year }}</td>
            <td>${{ car.price }}</td>
            <td>
                {% if car.in_stock %}
                    <span class="stock-status available">✓ Yes</span>
                {% else %}
                    <span class="stock-status unavailable">✗ No</span>
                {% endif %}
            </td>
            <td>
                <form method="post" action="{% url 'car_api_delete' car.id %}" class="api-delete-btn" onsubmit="return confirm('Are you sure you want to delete {{ car.make }} {{ car.model }} via API?');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-small">Delete (API)</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p class="car-count">
    Total cars fetched via API: <strong>{{ cars|length }}</strong>
</p>

<div class="card api-how-it-works">
    <h3>How It Works</h3>
    <p>This page uses the <code>NetworkHelper</code> class which:</p>
    <ul>
        <li>Makes HTTP GET request to <code>/api/cars/</code> using the <code>requests</code> library</li>
        <li>Retrieves JSON data from the REST API</li>
        <li>Displays the data in this template</li>
        <li>Uses DELETE requests to remove items via the API</li>
    </ul>
    <p class="mt-3">
        <strong>Note:</strong> The delete buttons use the REST API's DELETE endpoint.
    </p>
</div>
{% else %}
<div class="card text-center empty-inventory">
    <h3>No cars available via API</h3>
    <p>Either the API is not accessible or there are no cars in the database.</p>
    <p>Make sure:</p>
    <ul class="api-note-list">
        <li>The Django server is running</li>
        <li>You have created some cars in the database</li>
        <li>The API endpoint is accessible at <code>http://127.0.0.1:8000/api/cars/</code></li>
    </ul>
    <a href="{% url 'car_add' %}" class="btn btn-success mt-3">Add a Car</a>
</div>
{% endif %}
{% endblock %}

